(window.webpackJsonp=window.webpackJsonp||[]).push([[82],{VWn5:function(t,i,e){"use strict";e.r(i);var a=e("8Y7J");class n{}var s=e("pMnS"),u=e("mrSG"),r=e("iJLM"),d=e("g6cB"),o=e("jMFU");class l{constructor(t,i,e,a,n,s){this.activatedRoute=t,this.contentSvc=i,this.http=e,this.valueSvc=a,this.eventSvc=n,this.viewSvc=s,this.routeDataSubscription=null,this.isSmallSubscription=null,this.isLtMedium$=this.valueSvc.isLtMedium$,this.isLtMedium=!1,this.forPreview=window.location.href.includes("/author/"),this.isFetchingDataComplete=!1,this.isErrorOccured=!1,this.dndQuizData=null,this.oldData=null,this.alreadyRaised=!1}ngOnInit(){this.isSmallSubscription=this.isLtMedium$.subscribe(t=>{this.isLtMedium=t}),this.routeDataSubscription=this.activatedRoute.data.subscribe(t=>u.__awaiter(this,void 0,void 0,(function*(){this.dndQuizData=t.content.data,this.alreadyRaised&&this.oldData&&this.raiseEvent(d.g.EnumTelemetrySubType.Unloaded,this.oldData),this.dndQuizData&&this.dndQuizData.artifactUrl.indexOf("content-store")>=0&&(yield this.setS3Cookie(this.dndQuizData.identifier)),this.dndQuizData&&this.dndQuizData.mimeType===r.h.EMimeTypes.CLASS_DIAGRAM&&(this.dndQuizManifest=yield this.transformClassDiagram(this.dndQuizData)),this.dndQuizData&&this.dndQuizManifest?(this.oldData=this.dndQuizData,this.alreadyRaised=!0,this.raiseEvent(d.g.EnumTelemetrySubType.Loaded,this.dndQuizData),this.isFetchingDataComplete=!0):this.isErrorOccured=!0})),()=>{})}ngOnDestroy(){return u.__awaiter(this,void 0,void 0,(function*(){this.activatedRoute.snapshot.queryParams.collectionId&&this.activatedRoute.snapshot.queryParams.collectionType&&this.dndQuizData?yield this.contentSvc.continueLearning(this.dndQuizData.identifier,this.activatedRoute.snapshot.queryParams.collectionId,this.activatedRoute.snapshot.queryParams.collectionType):this.dndQuizData&&(yield this.contentSvc.continueLearning(this.dndQuizData.identifier)),this.routeDataSubscription&&this.routeDataSubscription.unsubscribe(),this.isSmallSubscription&&this.isSmallSubscription.unsubscribe(),this.dndQuizData&&this.raiseEvent(d.g.EnumTelemetrySubType.Unloaded,this.dndQuizData)}))}transformClassDiagram(t){return u.__awaiter(this,void 0,void 0,(function*(){let t="";if(this.dndQuizData&&this.dndQuizData.artifactUrl){const i=this.forPreview?this.viewSvc.getAuthoringUrl(this.dndQuizData.artifactUrl):this.dndQuizData.artifactUrl;t=yield this.http.get(i).toPromise().catch(t=>{})}return t}))}raiseEvent(t,i){this.eventSvc.dispatchEvent({eventType:d.g.WsEventType.Telemetry,eventLogLevel:d.g.WsEventLogLevel.Info,from:"dnd-quiz",to:"",data:{state:t,type:d.g.WsTimeSpentType.Player,mode:d.g.WsTimeSpentMode.Play,content:i,identifier:i?i.identifier:null,mimeType:r.h.EMimeTypes.CLASS_DIAGRAM,url:i?i.artifactUrl:null}})}setS3Cookie(t){return u.__awaiter(this,void 0,void 0,(function*(){yield this.contentSvc.setS3Cookie(t).toPromise().catch(()=>{})}))}}var h=e("iInd"),c=e("4fW1"),v=e("IheW"),b=e("TPUF"),p=e("Q3Rl"),m=a.sb({encapsulation:0,styles:[[""]],data:{}});function D(t){return a.Qb(0,[(t()(),a.ub(0,0,null,null,1,"p",[],null,null,null,null,null)),(t()(),a.Ob(-1,null,["dnd-quiz works!"]))],null,null)}function S(t){return a.Qb(0,[(t()(),a.ub(0,0,null,null,1,"viewer-dnd-quiz",[],null,null,null,D,m)),a.tb(1,245760,null,0,l,[h.a,c.a,v.c,b.a,p.a,o.a],null,null)],(function(t,i){t(i,1,0)}),null)}var f=a.qb("viewer-dnd-quiz",l,S,{},{},[]),y=e("SVse"),z=e("oPrN"),Q=e("GYRC"),E=e("tHRR"),g=e("bKtt"),w=e("ZGdF"),T=e("88ff"),M=e("/HVE");class L{}e.d(i,"DndQuizModuleNgFactory",(function(){return R}));var R=a.rb(n,[],(function(t){return a.Db([a.Eb(512,a.j,a.bb,[[8,[s.a,f]],[3,a.j],a.w]),a.Eb(4608,y.r,y.q,[a.t,[2,y.N]]),a.Eb(4608,z.a,z.a,[c.a,Q.a,E.a,h.o,g.a,w.a,T.a,M.a]),a.Eb(1073742336,y.c,y.c,[]),a.Eb(1073742336,h.s,h.s,[[2,h.x],[2,h.o]]),a.Eb(1073742336,L,L,[]),a.Eb(1073742336,n,n,[]),a.Eb(256,a.t,"hi",[]),a.Eb(1024,h.m,(function(){return[[{path:":resourceId",component:l,resolve:{content:z.a}}]]}),[])])}))}}]);